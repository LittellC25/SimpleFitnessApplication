<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.7.7/dist/full.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <title>Exercise - Fitness Tracker</title>
</head>

<body class="bg-gray-50 dark:bg-gray-900">
    <header class="bg-white border-b border-gray-200 dark:bg-gray-900">
        <div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl p-4">
            <a href="index.html" class="flex items-center">
                <span class="material-symbols-outlined mx-2">sports_basketball</span>
                Fitness Tracker
            </a>
        </div>
    </header>
    <div class="bg-white p-4 shadow-md mb-4"> 
        <div class="container mx-auto">
            <ul class="flex space-x-4">
                <li><a href="dashboard.html" class="px-3 py-1 bg-gray-100 text-blue-600 rounded hover:bg-gray-200">Dashboard</a></li>
                <li><a href="exercise.html" class="px-3 py-1 bg-gray-100 text-blue-600 rounded hover:bg-gray-200">Exercise</a></li>
                <li><a href="progress.html" class="px-3 py-1 bg-gray-100 text-blue-600 rounded hover:bg-gray-200">Progress</a></li>
                <li><a href="goals.html" class="px-3 py-1 bg-gray-100 text-blue-600 rounded hover:bg-gray-200">Goals</a></li>
                <li><a href="reminders.html" class="px-3 py-1 bg-gray-100 text-blue-600 rounded hover:bg-gray-200">Reminders</a></li>
                <li><a href="notifications.html" class="px-3 py-1 bg-gray-100 text-blue-600 rounded hover:bg-gray-200">Notifications</a></li>
            </ul>
        </div>
    </div>

    <section class="bg-white dark:bg-gray-900">
        <div class="py-8 px-4 mx-auto max-w-2xl lg:py-16">
            <h2 class="mb-4 text-xl font-bold text-gray-900 dark:text-white">Log Exercise</h2>
            <!-- Start and Stop Timer Buttons -->
            <button type="button" id="startTimer" class="m-4 inline-flex items-center px-4 py-2.5 text-sm font-medium text-center text-white bg-blue-700 rounded-lg focus:ring-4 focus:ring-primary-200 dark:focus:ring-primary-900 hover:bg-blue-800">
                Start Timer
            </button>
            <button type="button" id="stopTimer" class="m-4 inline-flex items-center px-4 py-2.5 text-sm font-medium text-center text-white bg-blue-700 rounded-lg focus:ring-4 focus:ring-primary-200 dark:focus:ring-primary-900 hover:bg-blue-800">
                Stop Timer
            </button>

            <form id="exerciseForm" class="grid gap-4 sm:grid-cols-2 sm:gap-6">
                <!-- Stairs Climbed -->
                <div>
                    <label for="stairs_climbed" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Stairs Climbed</label>
                    <input type="number" id="stairs_climbed" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" />
                </div>

                <!-- Steps Taken -->
                <div>
                    <label for="steps_taken" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Steps Taken</label>
                    <input type="number" id="steps_taken" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" />
                </div>

                <!-- Pushups -->
                <div>
                    <label for="pushups" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Pushups</label>
                    <input type="number" id="pushups" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" />
                </div>

                <!-- Sit-ups -->
                <div>
                    <label for="sit_ups" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Sit-ups</label>
                    <input type="number" id="sit_ups" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" />
                </div>

                <!-- Pull-ups -->
                <div>
                    <label for="pull_ups" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Pull-ups</label>
                    <input type="number" id="pull_ups" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" />
                </div>

                <!-- Squats -->
                <div>
                    <label for="squats" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Squats</label>
                    <input type="number" id="squats" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" />
                </div>

                <!-- Duration -->
                <div>
                    <label for="duration" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Duration</label>
                    <input type="number" id="duration" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" />
                </div>

                <!-- Timer Display -->
                <p id="timer" class="font-extrabold tracking-tight leading-none text-gray-900 dark:text-white">00:00</p>

                <!-- Submit Button -->
                <div class="sm:col-span-2">
                    <button type="submit" class="inline-flex items-center px-5 py-2.5 mt-4 sm:mt-6 text-sm font-medium text-center text-white bg-blue-700 rounded-lg focus:ring-4 focus:ring-primary-200 dark:focus:ring-primary-900 hover:bg-blue-800">Log Exercise</button>
                </div>
            </form>
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let timerInterval;
            let timerRunning = false;
            let durationInSeconds = 0;

            document.getElementById('startTimer').addEventListener('click', () => {
                if (!timerRunning) {
                    timerInterval = setInterval(updateTimer, 1000);
                    timerRunning = true;
                }
            });

            document.getElementById('stopTimer').addEventListener('click', () => {
                clearInterval(timerInterval);
                timerRunning = false;
            });

            function updateTimer() {
                durationInSeconds += 1;
                const minutes = Math.floor(durationInSeconds / 60);
                const seconds = durationInSeconds % 60;
                document.getElementById('timer').textContent = `${pad(minutes)}:${pad(seconds)}`;
            }

            function pad(number) {
                return (number < 10) ? `0${number}` : number;
            }

            function calculateTotalCaloriesBurned(exerciseData) {
                const calorieBurnRates = {
                    stairs_climbed: 0.5,
                    steps_taken: 0.1,
                    pushups: 2.0,
                    sit_ups: 1.5,
                    pull_ups: 3.0,
                    squats: 1.0,
                };
                
                let totalCaloriesBurned = 0;
                for(const exerciseType in exerciseData) {
                    if(calorieBurnRates.hasOwnProperty(exerciseType)) {
                        const count = Number(exerciseData[exerciseType]) || 0;
                        totalCaloriesBurned += count * calorieBurnRates[exerciseType];
                    }
                }
                return totalCaloriesBurned;
            }

            const form = document.getElementById('exerciseForm');

            form.addEventListener('submit', (event) => {
                event.preventDefault();

                let exerciseData = {
                    stairs_climbed: Number(form.stairs_climbed.value) || 0,
                    steps_taken: Number(form.steps_taken.value) || 0,
                    pushups: Number(form.pushups.value) || 0,
                    sit_ups: Number(form.sit_ups.value) || 0,
                    pull_ups: Number(form.pull_ups.value) || 0,
                    squats: Number(form.squats.value) || 0,
                    duration: Number(form.duration.value) || 0,
                    timestamp: new Date().toISOString(),
                    totalCaloriesBurned: 0, // Initialize to 0, will update below
                };

                // Calculate and update totalCaloriesBurned for the current exercise log
                exerciseData.totalCaloriesBurned = calculateTotalCaloriesBurned(exerciseData);

                let exerciseLogs = JSON.parse(localStorage.getItem('exerciseLogs')) || [];
                exerciseLogs.push(exerciseData);
                localStorage.setItem('exerciseLogs', JSON.stringify(exerciseLogs));

                form.reset();
                durationInSeconds = 0;
                document.getElementById('timer').textContent = '00:00';

                alert('Exercise logged successfully');
                // navigate to the dashboard
                window.location.href = 'dashboard.html'; 
            });
        });
    </script>

</body>

</html>
