<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.7.7/dist/full.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <title>Dashboard - Fitness Tracker</title>
</head>

<body>
    <header class="bg-white border-b border-gray-200 dark:bg-gray-900">
        <div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl p-4">
            <a href="index.html" class="flex items-center">
                <span class="material-symbols-outlined mx-2">sports_basketball</span>
                Fitness Tracker
            </a>
        </div>
    </header>
    <div class="bg-white p-4 shadow-md mb-4">
        <div class="container mx-auto">
            <ul class="flex space-x-4">
                <li><a href="dashboard.html" class="px-3 py-1 bg-gray-100 text-blue-600 rounded hover:bg-gray-200">Dashboard</a></li>
                <li><a href="exercise.html" class="px-3 py-1 bg-gray-100 text-blue-600 rounded hover:bg-gray-200">Exercise</a></li>
                <li><a href="progress.html" class="px-3 py-1 bg-gray-100 text-blue-600 rounded hover:bg-gray-200">Progress</a></li>
                <li><a href="goals.html" class="px-3 py-1 bg-gray-100 text-blue-600 rounded hover:bg-gray-200">Goals</a></li>
                <li><a href="reminders.html" class="px-3 py-1 bg-gray-100 text-blue-600 rounded hover:bg-gray-200">Reminders</a></li>
                <li><a href="notifications.html" class="px-3 py-1 bg-gray-100 text-blue-600 rounded hover:bg-gray-200">Notifications</a></li>
            </ul>
        </div>
    </div>

    <div id="cards" class="grid gap-4 md:gap-8 grid-cols-1 md:grid-cols-2 xl:grid-cols-3 m-4">
    </div>

    <div id="charts" class="grid gap-4 md:gap-8 grid-cols-1 md:grid-cols-2 xl:grid-cols-3 m-4">
    </div>

    <div class="relative overflow-x-auto shadow-md sm:rounded-lg mx-8 my-4">
        <table id="averageTable" class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
        </table>
    </div>

    <script>

        document.addEventListener('DOMContentLoaded', function () {
            const exerciseLogs = JSON.parse(localStorage.getItem('exerciseLogs')) || [];
            console.log(exerciseLogs)
            let totalDuration = 0, totalExercises = exerciseLogs.length, totalCaloriesBurned = 0;
            
            // Initialize data structures
            let dailyData = {labels: ['Yesterday', 'Today'], values: [0, 0]};
            let weeklyData = {labels: ['Last Week', 'This Week'], values: [0, 0]};
            let monthlyData = {labels: ['Last Month', 'This Month'], values: [0, 0]};



            let averageData = {
                stairsClimbed: 0,
                stepsTaken: 0,
                pushups: 0,
                sitUps: 0,
                pullUps: 0,
                squats: 0,
            };
            
            exerciseLogs.forEach(log => {
                totalDuration += log.duration; 
                totalCaloriesBurned += log.totalCaloriesBurned;

                // Sum the values for each exercise type
                averageData.stairsClimbed += log.stairs_climbed || 0;
                averageData.stepsTaken += log.steps_taken || 0;
                averageData.pushups += log.pushups || 0;
                averageData.sitUps += log.sit_ups || 0;
                averageData.pullUps += log.pull_ups || 0;
                averageData.squats += log.squats || 0;

                const logDate = new Date(log.timestamp);
        
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                if(logDate.toDateString() === today.toDateString())
                    dailyData.values[1] += log.totalCaloriesBurned;
                
                if(logDate.toDateString() === yesterday.toDateString())
                    dailyData.values[0] += log.totalCaloriesBurned;
                
                // Weekly Data
                const startOfWeek = today.getDate() - today.getDay();
                const startOfLastWeek = startOfWeek - 7;
                
                const daysSinceStartOfWeek = logDate.getDate() - startOfWeek;
                
                if(daysSinceStartOfWeek >= 0 && daysSinceStartOfWeek < 7)
                    weeklyData.values[1] += log.totalCaloriesBurned;
                
                if(daysSinceStartOfWeek >= -7 && daysSinceStartOfWeek < 0)
                    weeklyData.values[0] += log.totalCaloriesBurned;

                // Monthly Data
                const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                const startOfLastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 1);

                if(logDate >= startOfMonth)
                    monthlyData.values[1] += log.totalCaloriesBurned;
                
                if(logDate >= startOfLastMonth && logDate < startOfMonth)
                    monthlyData.values[0] += log.totalCaloriesBurned;
            });
            
            if(totalExercises > 0) {
                averageData.stairsClimbed /= totalExercises;
                averageData.stepsTaken /= totalExercises;
                averageData.pushups /= totalExercises;
                averageData.sitUps /= totalExercises;
                averageData.pullUps /= totalExercises;
                averageData.squats /= totalExercises;
            }
            
            const cardsContainer = document.getElementById('cards');
            const cardsData = [
                {title: 'Total Workout Duration (Last Week)', value: totalDuration, description: 'Total workout duration for the last week.'},
                {title: 'Total Exercises', value: totalExercises, description: 'Exercises logged so far.'},
                {title: 'Total Calories Burned', value: totalCaloriesBurned.toFixed(2), description: 'Calories burned through exercises.'},
            ];

            cardsData.forEach(data => {
                const card = document.createElement('div');
                card.className = 'bg-white border border-gray-200 rounded-lg shadow p-4 dark:bg-gray-800 dark:border-gray-700';
                
                const title = document.createElement('div');
                title.className = 'text-lg font-semibold text-gray-900 dark:text-white mb-2';
                title.textContent = data.title;
                card.appendChild(title);
                
                const value = document.createElement('div');
                value.className = 'text-2xl font-bold text-gray-900 dark:text-white';

                // Check if the current card is the 'Total Workout Duration' card and format the value accordingly
                if (data.title === 'Total Workout Duration (Last Week)') {
                    const hours = Math.floor(data.value / 3600);
                    const minutes = Math.floor((data.value % 3600) / 60);
                    const seconds = data.value % 60;
                    value.textContent = `${hours ? hours + ' hr ' : ''}${minutes ? minutes + ' min ' : ''}${seconds ? seconds + ' sec' : ''}`;
                } else {
                    value.textContent = data.value;
                }
                
                card.appendChild(value);
                
                const description = document.createElement('p');
                description.className = 'text-gray-700 dark:text-gray-400';
                description.textContent = data.description;
                card.appendChild(description);
                
                cardsContainer.appendChild(card);
            });

            
            const chartsContainer = document.getElementById('charts');
            const chartsData = [
                {id: 'daily-chart', data: dailyData, color: 'rgba(54, 162, 235, 0.6)', borderColor: 'rgba(54, 162, 235, 1)'},
                {id: 'weekly-chart', data: weeklyData, color: 'rgba(75, 192, 192, 0.6)', borderColor: 'rgba(75, 192, 192, 1)'},
                {id: 'monthly-chart', data: monthlyData, color: 'rgba(255, 159, 64, 0.6)', borderColor: 'rgba(255, 159, 64, 1)'},
            ];

            chartsData.forEach(chartData => {
                const chartContainer = document.createElement('div');
                chartContainer.className = 'bg-white border border-gray-200 rounded-lg shadow p-4 dark:bg-gray-800 dark:border-gray-700';
                const title = document.createElement('h2');
                title.className = 'text-lg font-semibold text-gray-900 dark:text-white mb-2';
                title.textContent = chartData.id.replace('-', ' ').replace(/^\w/, c => c.toUpperCase());
                chartContainer.appendChild(title);
                const canvasContainer = document.createElement('div');
                canvasContainer.className = 'chart-container';
                const canvas = document.createElement('canvas');
                canvas.id = chartData.id;
                canvas.width = 400;
                canvas.height = 200;
                canvasContainer.appendChild(canvas);
                chartContainer.appendChild(canvasContainer);
                chartsContainer.appendChild(chartContainer);

                const ctx = document.getElementById(chartData.id).getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: chartData.data.labels,
                        datasets: [{
                            label: title.textContent,
                            data: chartData.data.values,
                            backgroundColor: chartData.color,
                            borderColor: chartData.borderColor,
                            borderWidth: 1,
                        }],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                            },
                        },
                    },
                });
            });

            const table = document.getElementById('averageTable');
            const thead = document.createElement('thead');
            thead.className = 'text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400';
            const trHead = document.createElement('tr');
            ['Exercise Type', 'Average Count'].forEach(text => {
                const th = document.createElement('th');
                th.className = 'px-6 py-3';
                th.textContent = text;
                trHead.appendChild(th);
            });
            thead.appendChild(trHead);
            table.appendChild(thead);
            
            const tbody = document.createElement('tbody');
            Object.keys(averageData).forEach((key, index) => {
                const trBody = document.createElement('tr');
                trBody.className = index % 2 === 0 ? 'bg-white border-b dark:bg-gray-900 dark:border-gray-700' : 'border-b bg-gray-50 dark:bg-gray-800 dark:border-gray-700';
                const tdType = document.createElement('td');
                tdType.className = 'px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white';
                tdType.textContent = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase()); // Convert camelCase to Proper Case
                trBody.appendChild(tdType);
                const tdAverage = document.createElement('td');
                tdAverage.className = 'px-6 py-4';
                tdAverage.textContent = averageData[key].toFixed(2); // Two decimal places
                trBody.appendChild(tdAverage);
                tbody.appendChild(trBody);
            });
            table.appendChild(tbody);
        });
    </script>
</body>

</html>
